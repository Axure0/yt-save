<!DOCTYPE html>
<html lang="en">
  <head>
    <title>YT-Save</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/index.css">
  </head>
  <body>
    <div class="header">
      <h2>YT-Save</h2>
    </div>
    <div class="center">
      <form name="saveForm">
        <label for="link">Download Link</label><br>
        <input type="text" id="link" name="link"><br>
        <input type="submit" value="download" onclick="saveVideo(this.form)"> 
      </form>
    </div>
    <div class="results">
      <p class="1"></p>
      <p class="2"></p>
      <p class="3"></p>
    </div>
  </body>
  <script>
    const ytdl = require('youtube-dl')
    const fs = require('fs')
    const path = require('path')

    function saveVideo(form, elm1, elm2, elm3) {
      
      let filename 
      const video = ytdl(form.link.value, ['--format=18'], { cwd: process.cwd() })
      
      const fpath = path.join(__dirname + '/mp4')
      
      video.on('info', (info) => {
        filename = info._filename
        elm1.innerHtml = "Download Started"
        elm2.innerHtml = `Filename: ${filename}`
        elm3.innerHtml = `File size: ${info.size}`
      })
      
      video.pipe(fs.createWriteStream(fpath, `${filename}.mp4`))
      
    }
  </script>
</html>
